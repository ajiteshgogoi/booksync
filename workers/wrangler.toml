name = "booksync-worker"
main = "src/index.ts"
compatibility_date = "2025-01-26"

# Cron triggers for sync and cleanup jobs
[triggers]
crons = [
  "*/30 * * * *",  # Sync job
  "0 0 * * *"      # Cleanup job
]

[durable_objects]
bindings = [
  { name = "JOB_STORE", class_name = "JobStore" }
]

[[migrations]]
tag = "v1"
new_classes = ["JobStore"]

[[kv_namespaces]]
binding = "OAUTH_STORE"
id = "oauth_store"

[[r2_buckets]]
binding = "HIGHLIGHTS_BUCKET"
bucket_name = "highlights-bucket"

[vars]
NOTION_REDIRECT_URI = "https://booksync-worker.your-domain.workers.dev/oauth/callback"
WORKER_HOST = "booksync-worker.your-domain.workers.dev"

# Add your secret variables in .dev.vars or using wrangler secret commands
# wrangler secret put NOTION_CLIENT_ID
# wrangler secret put NOTION_CLIENT_SECRET

[build]
command = "npm run build"

[dev]
port = 8787
