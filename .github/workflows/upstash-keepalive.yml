name: Upstash Keepalive

on:
  schedule:
    # Run daily at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:  # Allow manual trigger

permissions:
  contents: read

jobs:
  keepalive:
    if: github.repository == 'ajiteshgogoi/booksync'
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v4
      
      - name: Test Redis connection
        env:
          REDIS_URL: ${{ secrets.REDIS_URL }}
        run: |
          if [ -z "$REDIS_URL" ]; then
            echo "❌ Missing Redis URL"
            exit 1
          fi
          
          echo "Testing Redis connection..."
          # Simple curl to the Redis URL to keep it active
          curl -I "$REDIS_URL"
          
          if [ $? -eq 0 ]; then
            echo "✅ Redis connection successful"
          else
            echo "❌ Redis connection failed"
            exit 1
          fi